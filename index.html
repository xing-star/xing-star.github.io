<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="学有境，创无穷">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="学有境，创无穷">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="学有境，创无穷">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">



<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-7525983411135191",
    enable_page_level_ads: true
  });
</script>


  <title>学有境，创无穷</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">学有境，创无穷</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-python">
          <a href="/categories/python/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>
            
            Python
          </a>
        </li>
      
        
        <li class="menu-item menu-item-bigdata">
          <a href="/categories/bigdata/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            大数据
          </a>
        </li>
      
        
        <li class="menu-item menu-item-databases">
          <a href="/categories/database/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>
            
            数据库
          </a>
        </li>
      
        
        <li class="menu-item menu-item-operations">
          <a href="/categories/operations/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            运维
          </a>
        </li>
      
        
        <li class="menu-item menu-item-deeplearning">
          <a href="/categories/deeplearning/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            深度学习
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/02/python错误信息/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xing-star">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学有境，创无穷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/02/python错误信息/" itemprop="url">python错误信息</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-02T18:00:00+08:00">
                2019-08-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="requests访问https出现这种错误，查询网上的方案都没能解决这个问题，后来发现是因为代理没有关闭导致的，插件已经禁用了代理，但是requests这里还是走了代理，需要直接在浏览器中勾选去掉才行"><a href="#requests访问https出现这种错误，查询网上的方案都没能解决这个问题，后来发现是因为代理没有关闭导致的，插件已经禁用了代理，但是requests这里还是走了代理，需要直接在浏览器中勾选去掉才行" class="headerlink" title="requests访问https出现这种错误，查询网上的方案都没能解决这个问题，后来发现是因为代理没有关闭导致的，插件已经禁用了代理，但是requests这里还是走了代理，需要直接在浏览器中勾选去掉才行"></a>requests访问https出现这种错误，查询网上的方案都没能解决这个问题，后来发现是因为代理没有关闭导致的，插件已经禁用了代理，但是requests这里还是走了代理，需要直接在浏览器中勾选去掉才行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> raise SSLError(e, request=request)</span><br><span class="line">requests.exceptions.SSLError: HTTPSConnectionPool(host=&apos;www.xxx.com&apos;, port=443): </span><br><span class="line">Max retries exceeded with url: /api/cmdb/cmdb/vlan/ListVlan/ </span><br><span class="line">(Caused by SSLError(SSLError(&quot;bad handshake: SysCallError(-1, &apos;Unexpected EOF&apos;)&quot;,),))</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/02/hexo笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xing-star">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学有境，创无穷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/02/hexo笔记/" itemprop="url">hexo笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-02T17:51:09+08:00">
                2019-08-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/operations/" itemprop="url" rel="index">
                    <span itemprop="name">operations</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1。更新github上的hexo博客"><a href="#1。更新github上的hexo博客" class="headerlink" title="1。更新github上的hexo博客"></a>1。更新github上的hexo博客</h3><ul>
<li><p>1.<figure class="highlight plain"><figcaption><span>clean #清除缓存```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- 2.```hexo g (hexo generate) #重新生成静态文件</span><br></pre></td></tr></table></figure></p>
</li>
<li><p>3.<code>hexo d (hexo deploy) #重新部署到github上</code></p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/16/errormessage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xing-star">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学有境，创无穷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/16/errormessage/" itemprop="url">errormessage</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-16T11:21:14+08:00">
                2019-07-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="requests访问https出现这种错误，查询网上的方案都没能解决这个问题，后来发现是因为代理没有关闭导致的，插件已经禁用了代理，但是requests这里还是走了代理，需要直接在浏览器中勾选去掉才行"><a href="#requests访问https出现这种错误，查询网上的方案都没能解决这个问题，后来发现是因为代理没有关闭导致的，插件已经禁用了代理，但是requests这里还是走了代理，需要直接在浏览器中勾选去掉才行" class="headerlink" title="requests访问https出现这种错误，查询网上的方案都没能解决这个问题，后来发现是因为代理没有关闭导致的，插件已经禁用了代理，但是requests这里还是走了代理，需要直接在浏览器中勾选去掉才行"></a>requests访问https出现这种错误，查询网上的方案都没能解决这个问题，后来发现是因为代理没有关闭导致的，插件已经禁用了代理，但是requests这里还是走了代理，需要直接在浏览器中勾选去掉才行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> raise SSLError(e, request=request)</span><br><span class="line">requests.exceptions.SSLError: HTTPSConnectionPool(host=&apos;www.xxx.com&apos;, port=443): </span><br><span class="line">Max retries exceeded with url: /api/cmdb/cmdb/vlan/ListVlan/ </span><br><span class="line">(Caused by SSLError(SSLError(&quot;bad handshake: SysCallError(-1, &apos;Unexpected EOF&apos;)&quot;,),))</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/16/saltstack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xing-star">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学有境，创无穷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/16/saltstack/" itemprop="url">saltstack</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-16T11:19:43+08:00">
                2019-07-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/operations/" itemprop="url" rel="index">
                    <span itemprop="name">operations</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="查看salt版本信息"><a href="#查看salt版本信息" class="headerlink" title="查看salt版本信息"></a>查看salt版本信息</h1><ul>
<li><figure class="highlight plain"><figcaption><span>--versions-report``` or ```rpm -qa | grep salt```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 启动salt</span><br><span class="line">-```/etc/init.d/salt-minion start</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/16/prometheus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xing-star">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学有境，创无穷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/16/prometheus/" itemprop="url">prometheus</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-16T11:19:33+08:00">
                2019-07-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/operations/" itemprop="url" rel="index">
                    <span itemprop="name">operations</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="prometheus从配置文件启动"><a href="#prometheus从配置文件启动" class="headerlink" title="prometheus从配置文件启动"></a>prometheus从配置文件启动</h3><ul>
<li><p>1.进入到prometheus解压缩目录，配置好prometheus.yml配置文件</p>
</li>
<li><p>2.<figure class="highlight plain"><figcaption><span>-config.file</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  - 3.访问默认该机器的ip+9090端口即可访问prometheus</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### Prometheus+AlertManager实现邮件告警</span><br><span class="line">- 1.在官网上下载prometheus和alertmanager的最新的压缩包，解压后在各自根目录下即可运行</span><br><span class="line">  - ```vi prometheus.yml```编辑prometheus配置文件：在：alerting下面绑定alertmanagers的访问地址</span><br></pre></td></tr></table></figure></p>
<p>alerting:<br>  alertmanagers:</p>
<ul>
<li>static_configs:<ul>
<li>targets: [“目标主机ip:9093”]<h1 id="alertmanager-9093"><a href="#alertmanager-9093" class="headerlink" title="- alertmanager:9093"></a>- alertmanager:9093</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- 在scrape_configs里面编辑node_exporter和mysql_exporter的连接方式</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>job_name: ‘node_mysql’<br>static_configs:</p>
<ul>
<li>targets: [‘目标主机ip:9100’]</li>
</ul>
</li>
</ul>
<ul>
<li><p>job_name: ‘mysql_host’<br>static_configs:</p>
<ul>
<li>targets: [‘目标主机ip:9104’]<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  - ```./prometheus``` # 默认从prometheus.yml中读取配置文件启动</span><br><span class="line">    - 此时可通过ip:9090访问prometheus,在web上的targets里面可以看到三个监控项，prometheus，mysql_host和node_mysql，prometheus的状态是up，其他两个都是down，现在我们去启动其他两个</span><br><span class="line">  - ```./alertmanager``` # 默认从alertmanager.yml中读取配置文件并启动</span><br><span class="line">    - 此时可通过ip:9093访问alertmanager</span><br><span class="line">  - 注意：如非最新版本在后续配置告警规则的时候会出错</span><br><span class="line">- 2.监控mysql</span><br><span class="line">  - 安装node_exporter组件（负责收集节点上的metrics监控数据，并将数据推送给prometheus），官网下载node_exporter组件，并解压。</span><br><span class="line">    - 启动node_exporter组件：```nohup /node_exporter目录/node_exporter &amp;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>安装mysql_exporter组件（收集mysql的性能参数），官网下载mysql_exporter组件，并解压。</p>
</li>
<li><p>由于mysqld_exporter需要连接到MySQL，创建用户并赋予所需的权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; GRANT REPLICATION CLIENT,PROCESS ON *.* TO &apos;mysql_monitor&apos;@&apos;localhost&apos; identified by &apos;mysql_monitor&apos;;</span><br><span class="line">mysql&gt; GRANT SELECT ON *.* TO &apos;mysql_monitor&apos;@&apos;localhost&apos;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建.my.cnf配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/mysqld_exporter-0.10.0.linux-amd64/.my.cnf</span><br><span class="line">[client]</span><br><span class="line">user=mysql_monitor</span><br><span class="line">password=mysql_monitor</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup /usr/local/mysqld_exporter-0.10.0.linux-amd64/mysqld_exporter --config.my-cnf=&quot;/usr/local/mysqld_exporter-0.10.0.linux-amd64/.my.cnf&quot; &amp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>此时再刷新prometheus的targets页面就能看到两个target的state为up了</p>
<ul>
<li>3.配置告警</li>
</ul>
</li>
<li><p>新建一个alertmanager的配置，用于配置告警邮件相关的内容<figure class="highlight plain"><figcaption><span>test.yml```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> </span><br></pre></td></tr></table></figure></p>
<p>global:<br>smtp_smarthost: ‘smtp.163.com:25’　　#163服务器<br>smtp_from: ‘XXX@163.com’　　　　　　　　#发邮件的邮箱<br>smtp_auth_username: ‘XXX@163.com’　　#发邮件的邮箱用户名，也就是你的邮箱<br>smtp_auth_password: ‘XXX’　　　　　　　　#发邮件的邮箱密码</p>
<p>route:<br>group_by: [‘alertname’]</p>
<p>repeat_interval: 1h</p>
<p>receiver: live-monitoring</p>
<p>receivers:</p>
<ul>
<li>name: ‘live-monitoring’<br>email_configs:<ul>
<li>to: ‘1234@qq.com’　　　　　　　　#收邮件的邮箱<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- 添加一个告警规则（node_down.yml）</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<p>groups:</p>
</li>
<li><p>name: example<br>rules:</p>
<ul>
<li>alert: InstanceDown<br>expr: up == 0<br>for: 1m<br>labels:<br>  user: test<br>annotations:<br>  summary: “Instance  down”<br>  description: “ of job  has been down for more than 1 minutes.”<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- 修改prometheus配置文件prometheus.yml，开启报警功能，添加报警规则配置文件</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="Alertmanager-configuration"><a href="#Alertmanager-configuration" class="headerlink" title="Alertmanager configuration"></a>Alertmanager configuration</h1><p>alerting:<br>alertmanagers:</p>
<ul>
<li>static_configs:<ul>
<li>targets: [“localhost:9093”]<h1 id="alertmanager-9093-1"><a href="#alertmanager-9093-1" class="headerlink" title="- alertmanager:9093"></a>- alertmanager:9093</h1></li>
</ul>
</li>
</ul>
<h1 id="Load-rules-once-and-periodically-evaluate-them-according-to-the-global-‘evaluation-interval’"><a href="#Load-rules-once-and-periodically-evaluate-them-according-to-the-global-‘evaluation-interval’" class="headerlink" title="Load rules once and periodically evaluate them according to the global ‘evaluation_interval’."></a>Load rules once and periodically evaluate them according to the global ‘evaluation_interval’.</h1><p>rule_files:</p>
<ul>
<li>“node_down.yml”<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- 重新启动prometheus，后台启动可用nohup，重启alertmanager```./alertmanager --config.file test.yml</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>可通过目标ip:9090的alerts页面查看告警规则是否添加成功。</p>
</li>
<li><p>此时可在目标主机上停止mysql_exporter,在alertmanager页面能看到InstanceDown变成（1active），并处在PENDING状态，1min后变成FIRING状态，耐心等待几分钟就能在你配置到邮箱中看到prometheus发给你到邮件了。</p>
</li>
</ul>
<h3 id="prometheus-HTTP-API接口"><a href="#prometheus-HTTP-API接口" class="headerlink" title="prometheus HTTP API接口"></a>prometheus HTTP API接口</h3><ul>
<li>(1) 直接查询某一监控指标：</li>
<li>GET<ul>
<li>example：<a href="http://localhost:9090/api/v1/query?query=process_start_time_seconds" target="_blank" rel="noopener">http://localhost:9090/api/v1/query?query=process_start_time_seconds</a></li>
</ul>
</li>
<li>(2)根据某一字段加上标签：</li>
<li>GET<ul>
<li>example：比如查询job为prometheus的process_start_time_seconds指标<ul>
<li><a href="http://localhost:9090/api/v1/query?query=process_start_time_seconds{job=&quot;prometheus&quot;}" target="_blank" rel="noopener">http://localhost:9090/api/v1/query?query=process_start_time_seconds{job=&quot;prometheus&quot;}</a></li>
</ul>
</li>
</ul>
</li>
<li>(3)正则表达式匹配前缀：<ul>
<li>example：比如一些监控 指标都以pro开头，可以通过正则表达式匹配前缀的方式一把搂回来<ul>
<li>htp://localhost:9090/api/v1/query?query={<strong>name</strong>=~”pro.*”}</li>
</ul>
</li>
<li>example：当然prometheus是支持各个标签 label之间通过and ，or ，unless进行组合，比如：查询出job名为progres，标签名以pro为前缀的监控数据。<ul>
<li>htp://localhost:9090/api/v1/query?query={<strong>name</strong>=~”pro.*”}and{job=”progres”}</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="官网接口"><a href="#官网接口" class="headerlink" title="官网接口"></a>官网接口</h4><ul>
<li><p>即时查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/query</span><br><span class="line">POST /api/v1/query</span><br></pre></td></tr></table></figure>

<ul>
<li>eg:下列例子表示查询在2015-07-01T20:10:51.781Z时间上的数据<figure class="highlight plain"><figcaption><span>'http://localhost:9090/api/v1/query?query</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">- 范围查询</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<p>GET /api/v1/query_range<br>POST /api/v1/query_range</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  - eg:下面的示例在30秒范围内查询数据，且查询的周期为15秒</span><br><span class="line">```curl &apos;http://localhost:9090/api/v1/query_range?query=up&amp;start=2015-07-01T20:10:30.781Z&amp;end=2015-07-01T20:11:00.781Z&amp;step=15s&apos;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>查询元数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/series</span><br><span class="line">POST /api/v1/series</span><br></pre></td></tr></table></figure>

<ul>
<li>eg:下面的示例返回匹配up或process_start_time_seconds{job=”prometheus”}的所有序列<figure class="highlight plain"><figcaption><span>-g 'http://localhost:9090/api/v1/series?' --data-urlencode</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">- 获取标签名字</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<p>GET /api/v1/labels<br>POST /api/v1/labels</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  - eg:下面示例是字符串标签名称列表。</span><br><span class="line">```curl &apos;localhost:9090/api/v1/labels&apos;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>查询标签值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/label/&lt;label_name&gt;/values</span><br></pre></td></tr></table></figure>

<ul>
<li>eg:这个例子查询作业标签的所有标签值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9090/api/v1/label/job/values</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>目标</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/targets</span><br></pre></td></tr></table></figure>

<ul>
<li>eg:获取所有的targets<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9090/api/v1/targets</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>规则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/rules</span><br></pre></td></tr></table></figure>

<ul>
<li>eg:rules API端点返回当前加载的警报和记录规则列表。此外，它还返回普罗米修斯实例为每个警报规则发出的当前活动警报,由于/rules端点是相当新的，所以它不具有与API v1相同的稳定性保证。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9090/api/v1/rules</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>警报</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/alerts</span><br></pre></td></tr></table></figure>

<ul>
<li>eg:警报端点返回所有活动警报的列表。由于/alerts端点是相当新的，所以它不具有与API v1相同的稳定性保证。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9090/api/v1/alerts</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>查询目标元数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/targets/metadata</span><br></pre></td></tr></table></figure>

<ul>
<li><p>eg:下面的示例返回来自前两个目标的go_goroutines度量的所有元数据条目，其标签为job=”prometheus”。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -G http://localhost:9091/api/v1/targets/metadata \</span><br><span class="line">    --data-urlencode &apos;metric=go_goroutines&apos; \</span><br><span class="line">    --data-urlencode &apos;match_target=&#123;job=&quot;prometheus&quot;&#125;&apos; \</span><br><span class="line">    --data-urlencode &apos;limit=2&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>eg:下面的示例返回标签instance=”127.0.0.1:9090 “的所有目标的所有指标的元数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -G http://localhost:9091/api/v1/targets/metadata \</span><br><span class="line">    --data-urlencode &apos;match_target=&#123;instance=&quot;127.0.0.1:9090&quot;&#125;&apos;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>当前状态概览</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/alertmanagers</span><br></pre></td></tr></table></figure>

<ul>
<li>eg:active和drop alertmanager都是响应的一部分。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9090/api/v1/alertmanagers</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>状态（以下状态端点公开当前普罗米修斯配置。）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/status/config</span><br></pre></td></tr></table></figure>

<ul>
<li>eg:配置作为转储YAML文件返回。由于YAML库的限制，不包括YAML注释。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9090/api/v1/status/config</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>标志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/status/flags</span><br></pre></td></tr></table></figure>

<ul>
<li>eg:所有值都是“string”的形式。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9090/api/v1/status/flags</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="告警组件"><a href="#告警组件" class="headerlink" title="告警组件"></a>告警组件</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/16/centos/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xing-star">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学有境，创无穷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/16/centos/" itemprop="url">centos</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-16T11:19:20+08:00">
                2019-07-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/operations/" itemprop="url" rel="index">
                    <span itemprop="name">operations</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="查看防火墙状态"><a href="#查看防火墙状态" class="headerlink" title="查看防火墙状态"></a>查看防火墙状态</h3><figure class="highlight plain"><figcaption><span>--state```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- 停止firewall</span><br><span class="line">```systemctl stop firewalld.service</span><br></pre></td></tr></table></figure>

<ul>
<li>禁止firewall开机启动<figure class="highlight plain"><figcaption><span>disable firewalld.service```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### SCP复制文件</span><br><span class="line">```scp local_file remote_username@remote_ip:remote_folder</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="tar解压文件"><a href="#tar解压文件" class="headerlink" title="tar解压文件"></a>tar解压文件</h3><figure class="highlight plain"><figcaption><span>xvf *.gz文件```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 给文件夹开放所有权限</span><br><span class="line">```chmod -R 777 文件夹路径</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/11/sql笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xing-star">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学有境，创无穷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/11/sql笔记/" itemprop="url">sql笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-11T16:07:53+08:00">
                2019-07-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/database/" itemprop="url" rel="index">
                    <span itemprop="name">database</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="mysql备份某个表："><a href="#mysql备份某个表：" class="headerlink" title="mysql备份某个表："></a>mysql备份某个表：</h3><figure class="highlight plain"><figcaption><span>-u username -p databasename table1, table2... > backupname.sql```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">### mysql备份某个数据库：</span><br><span class="line">```mysqldump -u username -p databasename &gt; backupname.sql</span><br></pre></td></tr></table></figure>

<h3 id="mysql还原数据："><a href="#mysql还原数据：" class="headerlink" title="mysql还原数据："></a>mysql还原数据：</h3><figure class="highlight plain"><figcaption><span>-u username -p database < backupname.sql```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">### mac mysql配置文件</span><br><span class="line">```/usr/local/etc/my.cnf</span><br></pre></td></tr></table></figure>

<h3 id="创建数据库一定要使用utf8"><a href="#创建数据库一定要使用utf8" class="headerlink" title="创建数据库一定要使用utf8"></a>创建数据库一定要使用utf8</h3><figure class="highlight plain"><figcaption><span>database db_name default charset utf8;```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">### 创建test用户并授权db_name数据库给该用户并设置密码为123</span><br><span class="line">```GRANT ALL PRIVILEGES ON db_name.* TO &apos;test&apos;@&apos;%&apos; IDENTIFIED BY &apos;123&apos;;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/11/flask笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xing-star">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学有境，创无穷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/11/flask笔记/" itemprop="url">flask笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-11T16:07:00+08:00">
                2019-07-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="在使用flask-migrate的时候在使用"><a href="#在使用flask-migrate的时候在使用" class="headerlink" title="在使用flask_migrate的时候在使用"></a>在使用flask_migrate的时候在使用<figure class="highlight python"><figcaption><span>manage.py db migrate```的时候无法生成migrations/versions/表里面的迁移脚本</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- ```INFO  [alembic.env] No changes <span class="keyword">in</span> schema detected</span><br></pre></td></tr></table></figure></h3><ul>
<li><p>可能有两个原因：</p>
<ul>
<li><p>1。数据库中有alembic_version表，需要先删除再生成迁移脚本，不然不会生成表结构，因为你的情况可能是删除了其他表<br>并在没有更改models里面的orm关系时再启动命令，此时会检查到该表里面的版本信息没有改变，就不会再次重新生成了。</p>
</li>
<li><p>2。（当前我遇到的问题）：仅仅以为在models表中关联了db就可以被自动检测到orm映射关系的代码，其实还需要在manage.py<br>或db初始化的文件中我这里用的是项目的<strong>init</strong>.py导入该models里面的类，example<figure class="highlight plain"><figcaption><span>models import *```这样操作之后就可以生成</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    迁移脚本，并利用flask_migrate生成表结构。</span><br><span class="line"></span><br><span class="line">### 在flask非视图函数中执行查询数据库的操作时（常用于开启线程异步操作耗时间的数据库查询动作）</span><br><span class="line">  - ```&apos;No application found. Either work inside a view function or push&apos;</span><br><span class="line">RuntimeError: No application found. Either work inside a view function or push an application context. See http://flask-sqlalchemy.pocoo.org/contexts/.</span><br></pre></td></tr></table></figure></p>
</li>
<li><p>1：主要原因是需要直接实例化app 不要写create_app函数了，在启动文件中直接导入app对象。</p>
<ul>
<li><p>1.1：很多人是这样写init文件的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line">def create_app():</span><br><span class="line">  app = Flask(__name__)</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>1.2：然后再manage启动文件导入create_app</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from app import create_app,db</span><br><span class="line">app = create_app()</span><br></pre></td></tr></table></figure>

<ul>
<li>这样写后只能在视图函数中执行数据库的操作了</li>
<li>正确的做法是直接在init文件中<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- 再在manage文件中直接导入</span><br><span class="line">  ```from app import app</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>2.1：示例化db时不能使用：</p>
<ul>
<li><code>db = SQLAlchemy() db.init_app(app)</code></li>
</ul>
</li>
<li><p>2.2：应该使用：</p>
<ul>
<li><code>db = SQLAlchemy(app)</code>直接示例化</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/11/docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xing-star">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学有境，创无穷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/11/docker/" itemprop="url">docker常用命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-11T16:04:15+08:00">
                2019-07-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/operations/" itemprop="url" rel="index">
                    <span itemprop="name">operations</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><p>提交改动到镜像</p>
<ul>
<li><code>docker commit -a &quot;runoob.com&quot; -m &quot;my apache&quot; a404c6c174a2  mymysql:v1</code></li>
<li>-a :提交的镜像作者；</li>
<li>-c :使用Dockerfile指令来创建镜像；</li>
<li>-m :提交时的说明文字；</li>
<li>-p :在commit时，将容器暂停。</li>
</ul>
</li>
<li><p>打包镜像成tar包</p>
<ul>
<li>docker save -o 要保存的文件名.tar 要保存的镜像</li>
<li>docker save 要保存的镜像 &gt; 要保存的文件名.tar</li>
</ul>
</li>
<li><p>load tar文件，恢复成镜像</p>
<ul>
<li>docker load &lt; 文件名.tar</li>
</ul>
</li>
<li><p>重命名镜像</p>
<ul>
<li>docker tag IMAGEID(镜像id) REPOSITORY:TAG（仓库：标签）</li>
</ul>
</li>
<li><p>重命名容器</p>
<ul>
<li>docker rename old_app new_app</li>
</ul>
</li>
<li><p>运行docker容器</p>
<ul>
<li>docker run -dit -p0.0.0.0:6004:6004 –name=dk-trainer 容器id /bin/bash</li>
</ul>
</li>
<li><p>容器外执行容器里面的动作</p>
<ul>
<li>docker exec -dit inspection_math /bin/bash -c ‘cd /var/flask/; sh ./init.sh’</li>
</ul>
</li>
<li><p>执行supervisord以及运行docker时注入环境变量</p>
<ul>
<li>docker exec -it dk-dashboardv2.0 /bin/bash -c ‘supervisord -n’</li>
<li>docker run -dit -p0.0.0.0:8080:8080 –env-file /Users/mark/Developer/dashboard.env –name=dk-dashboardv2.0 dk-dashboard:v2.0  /bin/bash</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/11/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xing-star">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学有境，创无穷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/11/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-11T15:42:09+08:00">
                2019-07-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">xing-star</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xing-star</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
